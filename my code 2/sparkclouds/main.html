<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <title> SparkClouds </title>
    <script src='http://d3js.org/d3.v3.min.js' charset='utf-8'></script>
    <style type='text/css'>
      h3{
        font-family:sans-serif;
        text-align: center;
        color: #305031 ;
      }
      .line {
      fill: none;
      stroke: OrangeRed ;
      stroke-width: 1.5px;
      }
      div.container{
        /*float: left;*/
        display: inline-block;
      }
      div.word_container{
      
      }
      div.sparkline{
        width: 70px;
        height: 30px;
       
      }
      div.superContainer{
      
      }
    </style>
  </head>
  <body>
    <div class="superContainer">
        <!-- TODO do we need these here? can we just append divs? -->
        <div class="container">
          <div class="word_container"></div>
          <div class="sparkline"></div>
        </div>
        <div class="container">
          <div class="word_container"></div>
          <div class="sparkline"></div>
        </div>
        <div class="container">
          <div class="word_container"></div>
          <div class="sparkline"></div>
        </div>
        <div class="container">
          <div class="word_container"></div>
          <div class="sparkline"></div>
        </div>
        <div class="container">
          <div class="word_container"></div>
          <div class="sparkline"></div>
        </div>
        <div class="container">
          <div class="word_container"></div>
          <div class="sparkline"></div>
        </div>
        <div class="container">
          <div class="word_container"></div>
          <div class="sparkline"></div>
        </div>
        <div class="container">
          <div class="word_container"></div>
          <div class="sparkline"></div>
        </div>
        <div class="container">
          <div class="word_container"></div>
          <div class="sparkline"></div>
        </div>
        <div class="container">
          <div class="word_container"></div>
          <div class="sparkline"></div>
        </div>
        <div class="container">
          <div class="word_container"></div>
          <div class="sparkline"></div>
        </div>
        <div class="container">
          <div class="word_container"></div>
          <div class="sparkline"></div>
        </div>
        <div class="container">
          <div class="word_container"></div>
          <div class="sparkline"></div>
        </div>
        <div class="container">
          <div class="word_container"></div>
          <div class="sparkline"></div>
        </div>
        <div class="container">
          <div class="word_container"></div>
          <div class="sparkline"></div>
        </div>
        <div class="container">
          <div class="word_container"></div>
          <div class="sparkline"></div>
        </div>
        <div class="container">
          <div class="word_container"></div>
          <div class="sparkline"></div>
        </div>
        <div class="container">
          <div class="word_container"></div>
          <div class="sparkline"></div>
        </div>
        <div class="container">
          <div class="word_container"></div>
          <div class="sparkline"></div>
        </div>
        <div class="container">
          <div class="word_container"></div>
          <div class="sparkline"></div>
        </div>
        <div class="container">
          <div class="word_container"></div>
          <div class="sparkline"></div>
        </div>
        <div class="container">
          <div class="word_container"></div>
          <div class="sparkline"></div>
        </div>
        <div class="container">
          <div class="word_container"></div>
          <div class="sparkline"></div>
        </div>
        <div class="container">
          <div class="word_container"></div>
          <div class="sparkline"></div>
        </div>
        <div class="container">
          <div class="word_container"></div>
          <div class="sparkline"></div>
        </div>
        <div class="container">
          <div class="word_container"></div>
          <div class="sparkline"></div>
        </div>
        <div class="container">
          <div class="word_container"></div>
          <div class="sparkline"></div>
        </div>
        <div class="container">
          <div class="word_container"></div>
          <div class="sparkline"></div>
        </div>
        <div class="container">
          <div class="word_container"></div>
          <div class="sparkline"></div>
        </div>
        <div class="container">
          <div class="word_container"></div>
          <div class="sparkline"></div>
        </div>
        <div class="container">
          <div class="word_container"></div>
          <div class="sparkline"></div>
        </div>
        <div class="container">
          <div class="word_container"></div>
          <div class="sparkline"></div>
        </div>
        <div class="container">
          <div class="word_container"></div>
          <div class="sparkline"></div>
        </div>
        <div class="container">
          <div class="word_container"></div>
          <div class="sparkline"></div>
        </div>
        <div class="container">
          <div class="word_container"></div>
          <div class="sparkline"></div>
        </div>
        <div class="container">
          <div class="word_container"></div>
          <div class="sparkline"></div>
        </div>
        <div class="container">
          <div class="word_container"></div>
          <div class="sparkline"></div>
        </div>
        <div class="container">
          <div class="word_container"></div>
          <div class="sparkline"></div>
        </div>
        <div class="container">
          <div class="word_container"></div>
          <div class="sparkline"></div>
        </div>
        <div class="container">
          <div class="word_container"></div>
          <div class="sparkline"></div>
        </div>
        <div class="container">
          <div class="word_container"></div>
          <div class="sparkline"></div>
        </div>
        <div class="container">
          <div class="word_container"></div>
          <div class="sparkline"></div>
        </div>
        <div class="container">
          <div class="word_container"></div>
          <div class="sparkline"></div>
        </div>
        <div class="container">
          <div class="word_container"></div>
          <div class="sparkline"></div>
        </div>
        <div class="container">
          <div class="word_container"></div>
          <div class="sparkline"></div>
        </div>
        <div class="container">
          <div class="word_container"></div>
          <div class="sparkline"></div>
        </div>

    </div>


    <script type='text/javascript'>

      var width = 50;
      var height = 20;
      var margins = {top:0, bottom: 60, left: 60, right:15};
      var sparkline_width = 70;
      var sparkline_height = 30;

      var xScale = d3.scale.linear().range([0,sparkline_width]).nice();
      var yScale = d3.scale.linear().range([sparkline_height,0]).nice();

      var TextScale = d3.scale.linear().range([12, 100]).nice();


      d3.csv("combined3.csv", function(dataset){
        console.log(dataset);

        var nestedData = d3.nest()
                            .key(function(d) {return d.word})
                            .entries(dataset);

        nestedData.forEach(function(d){
          var total = 0;
          for(var i = 0; i < d.values.length; i++){
            total += +d.values[i].freq;
          }
          d.totalFrequency = total;
        })

        nestedData.sort(function(a, b){
          return (b.totalFrequency - a.totalFrequency);
        });


        TextScale.domain(d3.extent(nestedData, function(d) {return d.totalFrequency;}))


        var divs = d3.select('body').selectAll('.word_container')
                     .data(nestedData);



  console.log(nestedData);
  
		//进行单词的展示。
        divs.append("text")
            .text(function(d){return d.key})
            .style("font-family", "sans-serif")
            .style("font-size", function(d){return TextScale(d.totalFrequency)+"px"})
            .style("color", "purple");
			// .style("vertical-align", "top");
			

       var line = d3.svg.line()
         .x(function(d) { return xScale(+d.year); })
         .y(function(d) { return yScale(+d.freq); });

       var chart = divs.append("svg")
                        .attr("width", width)
                        .attr("height", height);

var line_divs = d3.select('body').selectAll('.sparkline')
                  .data(nestedData);
var  tubiao2 = line_divs.append("svg")
                 .attr("width", sparkline_width)
                 .attr("height", sparkline_height);

        tubiao2.append("path")
              .datum(function(d){
              
                xScale.domain([2001,2016]);//k可以随意改变年份的区间值。
                yScale.domain([0, 30]);
                //console.log(d.values);
                return d.values
              })
              .attr("class", "line")
              .attr("d", line);
        });


    </script>
  </body>
</html>